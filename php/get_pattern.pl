class_in('1509010690552_n6', '1509010690552_n13').
class_in('1509010690552_n13', '1509010690552_n6').
class_in('1509010690552_n50', '1509074143607_n271').
class_in('1509010690552_n64', '1509010690552_n13').
class_in('1509010690552_n117', '1509010690552_n123').
class_in('1509010690552_n117', '1548588455000_n514').
class_in('1509010690552_n127', '1509010690552_n13').
class_in('1509010690552_n137', '1509010690552_n134').
class_in('1509010690552_n141', '1509010690552_n134').
class_in('1509010690552_n141', '1509010690552_n137').
class_in('1509010690552_n145', '1509010690552_n141').
class_in('1509010690552_n148', '1509010690559_n230').
class_in('1509010690559_n173', '1509010690559_n201').
class_in('1509010690559_n184', '1509010690559_n173').
class_in('1509010690559_n207', '1509010690559_n173').
class_in('1509010690559_n222', '1509010690559_n173').
class_in('1509010690559_n229', '1509010690552_n82').
class_in('1509010690559_n230', '1509010690552_n47').
class_in('1509010690559_n236', '1509010690552_n13').
class_in('1509074143607_n308', '1509010690552_n13').
class_in('1548588455000_n427', '1509074143607_n271').
class_in('1548588455000_n443', '1548588455000_n512').
class_in('1548588455000_n465', '1548588455000_n522').
class_in('1548588455000_n467', '1548588455000_n516').
class_in('1548588455000_n469', '1548588455000_n525').
class_in('1548588455000_n471', '1509010690552_n123').
class_in('1548588455000_n471', '1548588455000_n514').
class_in('1548588455000_n473', '1548588455000_n427').
class_in('1548588455000_n473', '1548588455000_n437').
class_in('1548588455000_n473', '1548588455000_n476').
class_in('1548588455000_n501', '1548588455000_n533').
class_in('1548588455000_n503', '1548588455000_n536').
class_in('1548588455000_n505', '1548588455000_n531').
class_in('1548588455000_n507', '1548588455000_n529').
class_in('1548588455000_n509', '1548588455000_n527').
class_in('1548588455000_n516', '1548588455000_n529').
class_in('1548588455000_n519', '1548588455000_n531').
class_in('1548588455000_n522', '1548588455000_n529').
class_out('1509010690552_n6', '1509010690552_n13').
class_out('1509010690552_n13', '1509010690552_n6').
class_out('1509010690552_n13', '1509010690552_n64').
class_out('1509010690552_n13', '1509010690552_n127').
class_out('1509010690552_n13', '1509010690559_n236').
class_out('1509010690552_n13', '1509074143607_n308').
class_out('1509010690552_n47', '1509010690559_n230').
class_out('1509010690552_n82', '1509010690559_n229').
class_out('1509010690552_n123', '1509010690552_n117').
class_out('1509010690552_n123', '1548588455000_n471').
class_out('1509010690552_n134', '1509010690552_n137').
class_out('1509010690552_n134', '1509010690552_n141').
class_out('1509010690552_n137', '1509010690552_n141').
class_out('1509010690552_n141', '1509010690552_n145').
class_out('1509010690559_n173', '1509010690559_n184').
class_out('1509010690559_n173', '1509010690559_n207').
class_out('1509010690559_n173', '1509010690559_n222').
class_out('1509010690559_n201', '1509010690559_n173').
class_out('1509010690559_n230', '1509010690552_n148').
class_out('1509074143607_n271', '1509010690552_n50').
class_out('1509074143607_n271', '1548588455000_n427').
class_out('1548588455000_n427', '1548588455000_n473').
class_out('1548588455000_n437', '1548588455000_n473').
class_out('1548588455000_n476', '1548588455000_n473').
class_out('1548588455000_n512', '1548588455000_n443').
class_out('1548588455000_n514', '1509010690552_n117').
class_out('1548588455000_n514', '1548588455000_n471').
class_out('1548588455000_n516', '1548588455000_n467').
class_out('1548588455000_n522', '1548588455000_n465').
class_out('1548588455000_n525', '1548588455000_n469').
class_out('1548588455000_n527', '1548588455000_n509').
class_out('1548588455000_n529', '1548588455000_n507').
class_out('1548588455000_n529', '1548588455000_n516').
class_out('1548588455000_n529', '1548588455000_n522').
class_out('1548588455000_n531', '1548588455000_n505').
class_out('1548588455000_n531', '1548588455000_n519').
class_out('1548588455000_n533', '1548588455000_n501').
class_out('1548588455000_n536', '1548588455000_n503').
class_activity('1509010690559_n201', '1509010690559_n220').
class_activity('1509010690559_n212', '1509010690559_n229').
class_activity('1509010690559_n212', '1509010690559_n230').
class_activity('1509010690559_n229', '1509074143607_n285').
class_activity('1509074143607_n296', '1509074143607_n286').
class_activity('1509074143607_n296', '1509074143607_n292').
class_activity('1509074143607_n296', '1509074143607_n289').
class_activity('1509074143607_n296', '1509074143607_n295').
class_activity('1509074143607_n306', '1509074143607_n314').
class_activity('1548588455000_n440', '1548588455000_n427').
class_activity('1548588455000_n440', '1548588455000_n553').
class_activity('1548588455000_n493', '1548588455000_n427').
class_activity('1548588455000_n493', '1548588455000_n543').
class_activity('1548588455000_n498', '1548588455000_n427').
class_activity('1548588455000_n498', '1548588455000_n547').
class_activity('1509010690552_n21', '1509010690552_n47').
class_activity('1509010690552_n21', '1509010690552_n43').
class_activity('1509010690552_n21', '1509010690552_n35').
class_activity('1509010690552_n21', '1509010690552_n67').
class_activity('1509010690552_n21', '1509010690552_n39').
class_activity('1509010690552_n27', '1509010690552_n35').
class_activity('1509010690552_n27', '1509010690552_n43').
class_activity('1509010690552_n27', '1509010690552_n39').
class_activity('1509010690552_n27', '1509010690552_n67').
class_activity('1509010690552_n27', '1509010690552_n16').
class_activity('1509010690552_n47', '1509010690552_n134').
class_activity('1509010690552_n47', '1509010690552_n137').
class_activity('1509010690552_n47', '1509010690552_n141').
class_activity('1509010690552_n47', '1509010690552_n145').
class_activity('1509010690552_n76', '1509010690552_n82').
class_activity('1509010690552_n76', '1509010690552_n35').
class_activity('1509010690552_n76', '1509010690552_n39').
class_activity('1509010690552_n76', '1509010690552_n43').
class_activity('1509010690552_n76', '1509010690552_n67').
class_activity('1509010690552_n82', '1509010690559_n259').
class_activity('1509010690552_n83', '1509010690552_n98').
class_activity('1509010690552_n96', '1509010690552_n94').
class_activity('1509010690552_n102', '1509010690552_n35').
class_activity('1509010690552_n102', '1509010690552_n43').
class_activity('1509010690552_n102', '1509010690552_n39').
class_activity('1509010690552_n127', '1509010690552_n133').
class_activity('1509010690559_n173', '1509010690552_n107').
class_activity('1509010690559_n195', '1509010690559_n201').
class_activity('1509010690559_n195', '1509010690559_n184').
class_activity('1509010690559_n195', '1509010690559_n207').
class_activity('1509010690559_n195', '1509010690559_n212').
class_activity('1509010690559_n195', '1509010690559_n218').
class_activity('1509010690559_n201', '1509010690552_n93').
class_activity('1509010690559_n207', '1509010690559_n173').
class_activity('1509010690559_n212', '1509010690559_n222').
class_activity('1509010690559_n218', '1509010690559_n257').
class_activity('1509010690559_n218', '1509010690559_n170').
class_activity('1509010690559_n218', '1509010690559_n171').
class_activity('1509010690559_n222', '1509010690559_n236').
class_activity('1509010690559_n222', '1509010690559_n233').
class_activity('1509010690559_n233', '1509010690552_n108').
class_activity('1509010690559_n233', '1509010690552_n115').
class_activity('1509010690559_n236', '1509010690559_n233').
class_activity('1509010690559_n249', '1509010690559_n236').
class_activity('1509010690559_n253', '1509010690559_n236').
class_activity('1509010690559_n255', '1509010690559_n236').
class_activity('1509074143607_n308', '1509010690552_n127').
class_activity('1509074143607_n314', '1509010690552_n123').
class_activity('1509074143607_n314', '1509010690552_n117').
class_activity('1509074143607_n314', '1509010690552_n126').
class_activity('1509074143607_n314', '1509010690559_n180').
class_activity('1509074143607_n314', '1509010690552_n101').
class_activity('1509079418256_n348', '1509010690552_n134').
class_activity('1509079418256_n348', '1509010690552_n137').
class_activity('1509079418256_n348', '1509010690552_n141').
class_activity('1509079418256_n348', '1509010690552_n145').
class_activity('1509079418256_n348', '1509010690552_n148').
class_activity('1548588455000_n447', '1509010690552_n123').
class_activity('1548588455000_n447', '1509010690552_n117').
class_activity('1548588455000_n447', '1509010690552_n126').
class_activity('1548588455000_n447', '1509010690559_n180').
class_activity('1509010690552_n50', '1509010690552_n6').
class_activity('1509010690552_n82', '1509010690552_n21').
class_activity('1509010690552_n82', '1509010690552_n83').
class_activity('1509010690552_n83', '1509088161516_n419').
class_activity('1509010690559_n201', '1509010690552_n63').
class_activity('1509010690559_n201', '1509010690552_n95').
class_activity('1509010690559_n207', '1509010690552_n83').
class_activity('1509010690559_n222', '1509010690552_n76').
class_activity('1509074143607_n314', '1509010690552_n96').
class_activity('1548588455000_n445', '1548588455000_n473').
class_activity('1548588455000_n447', '1509010690552_n101').
class_activity('1548588455000_n447', '1509010690552_n96').
class_activity('1548588455000_n447', '1548588455000_n473').
class_activity('1548588455000_n447', '1548588455000_n445').
rationality('1509010690552_n134', '1509010690552_n137').
rationality('1509010690552_n134', '1509010690552_n141').
rationality('1509010690552_n137', '1509010690552_n141').
rationality('1509010690552_n137', '1509010690552_n145').
rationality('1509010690552_n141', '1509010690552_n145').
rationality('1509010690559_n229', '1509010690559_n230').
rationality('1509010690559_n222', '1509010690559_n229').
rationality('1509010690552_n134', '1509010690552_n145').
rationality('1509010690559_n201', '1509010690559_n184').
rationality('1509010690552_n123', '1509010690552_n117').
rationality('1509010690559_n173', '1509010690559_n184').
rationality('1509010690559_n201', '1509010690559_n173').
operation_log(datetime('2019-12-18 07:40:29.367'), ibss_log( 'f1605187e0b45642', 'add', 'prepared_question', '1509010690552_n21', 'New Node', 'root')). 
operation_log(datetime('2019-12-18 07:40:30.350'), ibss_log( 'f1605187e0b45642', 'edit', 'prepared_question', '1509010690552_n21', 'それは実践に落とし込めますか？', 'root')). 
operation_log(datetime('2019-12-18 08:23:14.496'), ibss_log( 'f162c38927e03ddf', 'edit', 'prepared_question', '1509010690552_n134', '実践の目的は何ですか？', 'root')). 
operation_log(datetime('2019-12-18 08:23:13.464'), ibss_log( 'f162c38927e03ddf', 'add', 'prepared_question', '1509010690552_n134', 'New Node', 'root')). 
operation_log(datetime('2019-12-24 06:36:27.112'), ibss_log( 'f34b09bddba2f750', 'add', 'answer', '', 'ああああ', 'f1605187e0b45642')). 
operation_log(datetime('2019-12-24 19:29:11.321'), ibss_log( 'f377415c2761841c', 'add', 'prepared_question', '1509010690559_n184', 'New Node', 'root')). 
operation_log(datetime('2019-12-24 19:29:12.356'), ibss_log( 'f377415c2761841c', 'edit', 'prepared_question', '1509010690559_n184', '研究目的は何ですか？', 'root')). 
operation_log(datetime('2019-12-24 19:29:17.771'), ibss_log( 'f37742b43706534e', 'add', 'question', '', 'New Node', 'root')). 
operation_log(datetime('2019-12-24 19:29:20.819'), ibss_log( 'f1605187e0b45642', 'delete', 'prepared_question', '1509010690552_n21', '', 'root')). 
operation_log(datetime('2019-12-24 19:29:23.608'), ibss_log( 'f162c38927e03ddf', 'delete', 'prepared_question', '1509010690552_n134', '', 'root')). 
operation_log(datetime('2019-12-24 19:29:26.978'), ibss_log( 'f37742b43706534e', 'delete', 'question', '', '', 'root')). 
operation_log(datetime('2019-12-24 19:29:28.547'), ibss_log( 'f377415c2761841c', 'delete', 'prepared_question', '1509010690559_n184', '', 'root')). 
operation_log(datetime('2019-12-24 19:29:43.587'), ibss_log( '', 'delete', '', '', '', '')). 
operation_log(datetime('2019-12-24 19:29:49.307'), ibss_log( '', 'delete', '', '', '', '')). 
operation_log(datetime('2019-12-24 19:29:51.426'), ibss_log( '', 'delete', '', '', '', '')). 
operation_log(datetime('2019-12-24 19:29:53.219'), ibss_log( 'f1605187e0b45642', 'delete', 'prepared_question', '1509010690552_n21', '', 'root')). 
operation_log(datetime('2019-12-24 19:29:56.330'), ibss_log( 'f3774c1e35ccdb01', 'add', 'question', '', 'New Node', 'root')). 
operation_log(datetime('2019-12-24 19:30:15.595'), ibss_log( 'f377510f48948223', 'add', 'prepared_question', '1509010690559_n184', 'New Node', 'f3774c1e35ccdb01')). 
operation_log(datetime('2019-12-24 19:30:16.584'), ibss_log( 'f377510f48948223', 'edit', 'prepared_question', '1509010690559_n184', '研究目的は何ですか？', 'f3774c1e35ccdb01')). 
operation_log(datetime('2019-12-24 19:30:49.153'), ibss_log( 'f3775940b1e2d98b', 'add', 'prepared_question', '1509010690559_n201', 'New Node', 'f3774c1e35ccdb01')). 
operation_log(datetime('2019-12-24 19:30:50.142'), ibss_log( 'f3775940b1e2d98b', 'edit', 'prepared_question', '1509010690559_n201', 'どのような問題を発見しましたか？', 'f3774c1e35ccdb01')). 
operation_log(datetime('2019-12-24 19:30:57.391'), ibss_log( 'f3775b0686ce9c92', 'add', 'answer', '1509010690559_n184', 'New Node', 'f377510f48948223')). 
operation_log(datetime('2019-12-24 19:30:59.662'), ibss_log( 'f3775b945007b6be', 'add', 'answer', '1509010690559_n201', 'New Node', 'f3775940b1e2d98b')). 
operation_log(datetime('2019-12-24 19:31:02.305'), ibss_log( 'f3775c70f02a0921', 'add', 'prepared_question', '1519483811401_n426', 'New Node', 'f3775b0686ce9c92')). 
operation_log(datetime('2019-12-24 19:31:03.302'), ibss_log( 'f3775c70f02a0921', 'edit', 'prepared_question', '1519483811401_n426', 'なぜこれらは合理的であるといえるのですか？', 'f3775b0686ce9c92')). 
operation_log(datetime('2019-12-24 19:31:05.754'), ibss_log( 'f3775d10f0bbf59b', 'add', 'answer', '1519483811401_n426', 'New Node', 'f3775c70f02a0921')). 
operation_log(datetime('2019-12-27 20:48:33.772'), ibss_log( 'f472fd14b166fb81', 'add', 'answer', '', 'New Node', 'f3775940b1e2d98b')). 
operation_log(datetime('2019-12-27 20:48:47.589'), ibss_log( 'f472fd14b166fb81', 'edit', 'answer', 'null', 'マザファカ', 'f3775940b1e2d98b')). 
operation_log(datetime('2019-12-27 20:48:54.040'), ibss_log( 'f3775b945007b6be', 'edit', 'answer', '1509010690559_n201', '青汁', 'f3775940b1e2d98b')). 
operation_log(datetime('2019-12-30 13:52:56.268'), ibss_log( 'f5526611986467bc', 'add', 'question', '', 'New Node', '')). 
operation_log(datetime('2019-12-30 14:40:18.230'), ibss_log( 'f5551bea2d3e7b8a', 'add', 'question', '', 'New Node', '')). 
operation_log(datetime('2019-12-30 14:40:24.370'), ibss_log( 'f5551bea2d3e7b8a', 'delete', 'question', '', '', 'null')). 
operation_log(datetime('2019-12-30 15:03:49.281'), ibss_log( 'f55674a6f142c588', 'add', 'prepared_question', '1509010690552_n133', 'New Node', 'f3774c1e35ccdb01')). 
operation_log(datetime('2019-12-30 15:03:50.334'), ibss_log( 'f55674a6f142c588', 'edit', 'prepared_question', '1509010690552_n133', '評価者はどのような人を想定していますか？', 'f3774c1e35ccdb01')). 
operation_log(datetime('2019-12-30 15:04:10.837'), ibss_log( 'f55679ea616a6ede', 'add', 'prepared_question', '1509010690552_n47', 'New Node', 'f3774c1e35ccdb01')). 
operation_log(datetime('2019-12-30 15:04:11.843'), ibss_log( 'f55679ea616a6ede', 'edit', 'prepared_question', '1509010690552_n47', '実践のデザインはどのようなものですか？', 'f3774c1e35ccdb01')). 
operation_log(datetime('2019-12-30 15:04:14.190'), ibss_log( 'f5567abbc1d7e90e', 'add', 'prepared_question', '1509010690559_n230', 'New Node', 'f55679ea616a6ede')). 
operation_log(datetime('2019-12-30 15:04:15.208'), ibss_log( 'f5567abbc1d7e90e', 'edit', 'prepared_question', '1509010690559_n230', '実践は行いましたか？', 'f55679ea616a6ede')). 
operation_log(datetime('2019-12-30 15:04:24.817'), ibss_log( 'f5567d5429ab185d', 'add', 'prepared_question', '1509010690552_n134', 'New Node', 'f55679ea616a6ede')). 
operation_log(datetime('2019-12-30 15:04:25.820'), ibss_log( 'f5567d5429ab185d', 'edit', 'prepared_question', '1509010690552_n134', '実践の目的は何ですか？', 'f55679ea616a6ede')). 
operation_log(datetime('2019-12-30 15:04:29.405'), ibss_log( 'f5567e34802d3ac5', 'edit', 'prepared_question', '1509010690552_n137', '実践仮説は何ですか？', 'f55679ea616a6ede')). 
operation_log(datetime('2019-12-30 15:04:28.403'), ibss_log( 'f5567e34802d3ac5', 'add', 'prepared_question', '1509010690552_n137', 'New Node', 'f55679ea616a6ede')). 
operation_log(datetime('2019-12-30 15:04:33.080'), ibss_log( 'f5567f57c56cc518', 'add', 'prepared_question', '1509010690552_n141', 'New Node', 'f55679ea616a6ede')). 
operation_log(datetime('2019-12-30 15:04:34.094'), ibss_log( 'f5567f57c56cc518', 'edit', 'prepared_question', '1509010690552_n141', '実践の手順はどのようなものですか？', 'f55679ea616a6ede')). 
operation_log(datetime('2019-12-30 15:24:42.629'), ibss_log( 'f472fd14b166fb81', 'edit', 'answer', '', '難問', 'f3775940b1e2d98b')). 
operation_log(datetime('2019-12-30 22:35:14.163'), ibss_log( 'f3775b945007b6be', 'edit', 'answer', '1509010690559_n201', '簡単', 'f3775940b1e2d98b')). 
operation_log(datetime('2019-12-30 22:35:30.843'), ibss_log( 'f3775b0686ce9c92', 'edit', 'answer', '1509010690559_n184', '人を騙すこと', 'f377510f48948223')). 
operation_log(datetime('2019-12-30 22:35:37.364'), ibss_log( 'f3775d10f0bbf59b', 'edit', 'answer', '1519483811401_n426', 'サッカー', 'f3775c70f02a0921')). 
operation_log(datetime('2019-12-30 23:26:31.573'), ibss_log( 'f573387b8921ba5a', 'add', 'prepared_question', '1509079418256_n378', 'New Node', 'f55679ea616a6ede')). 
operation_log(datetime('2019-12-30 23:26:32.639'), ibss_log( 'f573387b8921ba5a', 'edit', 'prepared_question', '1509079418256_n378', 'なぜそう考えるのですか？', 'f55679ea616a6ede')). 


%ルールの定義
%親子の定義
parent_of(X,Y) :- operation_log(datetime(_), ibss_log( Y, _, _, _, _, X)). % X＝親，Y=子

%祖先的なやつ
ancestor_of(X, Y) :- parent_of(X, Y). %X=祖先，Y=子孫
ancestor_of(X, Y) :- parent_of(X, Z), ancestor_of(Z, Y).

%時系列のルール
%time_compare(比較１，比較２，後の方)
time_compare(X,Y,X) :- X @> Y,!. %Xの方が後ならカット
time_compare(X,Y,Y) :- X @< Y.   %それ以外，つまりYの方が後ならカット


%同じノードへの操作
node_operation_of(X,Y)
:- operation_log(datetime(X), ibss_log( NodeID, _, _, _, _, _)),
   operation_log(datetime(Y), ibss_log( NodeID, _, _, _, _, _)).

%ある時(X)より昔でnode_idはYのノードの日にち
period_new_node(X,Y,K)
:- operation_log(datetime(K), ibss_log( Y, _, _, _, _, _)),K @< X.

%ある時(X)より昔でnode_idはYのノードの日にちを全て求める
period_old_nodeList(X, Ls) :- period_sub(X, [], Ls).
period_sub(X, C, Ls) :-
  period_old_node(X,Y, C1), not(member(C1, C)), !,
  period_sub(X, [C1 | C], Ls).
period_sub(_, Ls, Ls).


%あるノードに対する動作を全て求める
% リスト：父親 X の子供をすべて L に求める
node_operation(X, Ls) :- node_operation_sub(X, [], Ls).
node_operation_sub(X, C, Ls) :-
  node_operation_of(X, C1), not(member(C1, C)), !,
  node_operation_sub(X, [C1 | C], Ls).
node_operation_sub(_, Ls, Ls).

%リストを古い順に並び替え
time_sort([X | Xs], Ys) :-
        partition(Xs, X, Littles, Bigs),
        quick(Littles, Ls),
        quick(Bigs, Bs),
        append(Ls, [X | Bs], Ys).
quick([], []).

%ノード操作を古い順に並び替えてから求める
node_operation_timeList(X,L) :-
  node_operation(X, T),
  time_sort(T,L).

  period_old_node(X,Y,K)
  :- operation_log(datetime(K), ibss_log( Y, _, _, _, _, _)),K @< X.


  %ある時(X)より昔でnode_idはYのノードの日にちを全て求める
  period_old_nodeList(X, Y, Ls) :- period_sub(X, Y, [], Ls).
  period_sub(X, Y, C, Ls) :-
    period_old_node(X, Y, C1), not(member(C1, C)), !,
    period_sub(X, Y, [C1 | C], Ls).
  period_sub(_, _, Ls, Ls).


%最大値を取得
  newest_node(L,M) :-
        L = [F|R],
        newest_node(R,F,M).
  newest_node([],M,M).
  newest_node([Y|R],Mb,M) :-
        Y > Mb,!,
        newest_node(R,Y,M).
  newest_node([Y|R],Mb,M) :-
        newest_node(R,Mb,M).


        partition3([X | Xs], Y, [X | Ls], Bs) :-
                X @>= Y, partition3(Xs, Y, Ls, Bs).
        partition3([X | Xs], Y, Ls, [X | Bs]) :-
                X @< Y, partition3(Xs, Y, Ls, Bs).
        partition3([], Y, [], []).

        % %リストに要素が含まれているか．Xに変数を置くと一番最初の物を取り出すことができる
        my_member(X, [X | Ls]).
        my_member(X, [Y | Ls]) :- my_member(X, Ls).

        %リストの最初の値を取り出す
        first([X|_], X).


        %リストを新しい順に並び替え
        time_sort_newest([X | Xs], Ys) :-
                partition3(Xs, X, New, Old),
                time_sort_newest(New, Ls),
                time_sort_newest(Old, Os),
                append(Ls, [X | Os], Ys).
        time_sort_newest([], []).








        %ある時点に置いて最新の操作を取り出す
        newestDate_at_time(AtTime, NodeID, Newest_Node_time)
        :- period_old_nodeList(AtTime, NodeID, Node_ope_list),       %その時以前に加えられたノード操作の時間をリストに格納する
           time_sort_newest(Node_ope_list,Sort_Node_ope_list),              %リストを〜順に並び替える
           first(Sort_Node_ope_list, Newest_Node_time).%リストの最初のやつ(一番新しいやつ)を取り出す

        %operation_log(datetime(日時), ibss_log( ノードID, 操作, ノードタイプ, 概念ID, ノードテキスト, 親ノードID)).








%１. (real pattern_1)祖先を編集した後子孫を編集すること
pattern(rule_1, [Pattern, Template, Status, Act1, Act2, Act3, Act4, Act5, Act6])

 :- (operation_log(datetime(Act1), ibss_log( Qnode1, Activity1, Type1, _, _, _)), Type1\=='answer', Activity1\=='add'),

    (operation_log(datetime(Act2), ibss_log( Anode1, Activity2, 'answer', _, _, Qnode1)), Activity2\=='add'),

    operation_log(datetime(Act3), ibss_log( Anode1, 'edit', 'answer', _, _, Qnode1)),

    (operation_log(datetime(Act4), ibss_log( Qnode2, Activity4, Type4, _, _, _)), Type4\=='answer', Activity4\=='add'),

    (operation_log(datetime(Act5), ibss_log( Anode2, Activity5, 'answer', _, _, Qnode2)), Activity5\=='add', time_compare(Act3,Act5,Act3), newestDate_at_time(Act3, Anode2, Act5)),

    (operation_log(datetime(Act6), ibss_log( Anode2, 'edit', 'answer', _, _, _)),

     ancestor_of(Qnode1, Qnode2), newestDate_at_time(Act3, Anode1, Act2),

     newestDate_at_time(Act6, Qnode1, Act1), newestDate_at_time(Act6, Anode1, Act3), newestDate_at_time(Act6, Qnode2, Act4), newestDate_at_time(Act6, Anode2, Act5),

     Status='full', Template='template_1_1', Pattern='pattern_1').






pattern(rule_2, [Pattern, Template, Status, Act1, Act2, Act3, Act4, Act5, Act6])

 :- (operation_log(datetime(Act1), ibss_log( Qnode1, Activity1, Type1, _, _, _)), Type1\=='answer', Activity1\=='add'),

    operation_log(datetime(Act2_1), ibss_log( Anode1, Activity2, 'answer', _, _, Qnode1)),

    operation_log(datetime(Act3_1), ibss_log( Anode1, 'edit', 'answer', _, _, Qnode1)),

    (operation_log(datetime(Act4_1), ibss_log( Qnode2, Activity4, Type4, _, _, _)), Type4\=='answer', Activity4\=='add'),

    (operation_log(datetime(Act5_1), ibss_log( Anode2, Activity5, 'answer', _, _, Qnode2)), Activity5\=='add'),

    (operation_log(datetime(Act6_1), ibss_log( Anode2, 'edit', 'answer', _, _, _)),

     ancestor_of(Qnode2, Qnode1), newestDate_at_time(Act3_1, Anode1, Act2_1),

     newestDate_at_time(Act6_1, Qnode1, Act1), newestDate_at_time(Act6_1, Anode1, Act3_1), newestDate_at_time(Act6_1, Qnode2, Act4_1), newestDate_at_time(Act6_1, Anode2, Act5_1),

     Status='full', Pattern='pattern_2'),

    ((Activity2='add')->(Template='template_1_2', Act2=Act3_1, Act3=Act4_1, Act4=Act5_1, Act5=Act6_1, Act6='null' )

                        ;(Template='template_1_1', Act2=Act2_1, Act3=Act3_1, Act4=Act4_1, Act5=Act5_1, Act6=Act6_1 )).





                        %
                        %   operation_log(datetime('2019-01-24 08:29:03.560'), ibss_log( '87d0bac3cc2a5c05', 'edit', 'prepared_question', '1509010690552_n137', '実践仮説は何ですか？', 'root')).
                        % { operation_log(datetime('2019-01-24 08:29:05.370'), ibss_log( '87d0bb350420c832', 'add', 'answer', '1509010690552_n137', 'New Node', '87d0bac3cc2a5c05')).  }
                        %   operation_log(datetime('2019-01-24 08:29:14.035'), ibss_log( '87d0bb350420c832', 'edit', 'answer', '1509010690552_n137', '実践仮説なんて知らない', '87d0bac3cc2a5c05')).
                        %   operation_log(datetime('2019-01-24 08:28:48.499'), ibss_log( '87d0b7164be317d0', 'edit', 'prepared_question', '1509010690552_n134', '実践の目的は何ですか？', 'root')).
                        %   operation_log(datetime('2019-01-24 08:29:00.961'), ibss_log( '87d0b79a4627fa1b', 'edit', 'answer', '1509010690552_n134', '実践目的なんて知らない', '87d0b7164be317d0')).
                        %   operation_log(datetime('2019-01-24 08:29:00.961'), ibss_log( '87d0b79a4627fa1b', 'edit', 'answer', '1509010690552_n134', '実践目的なんて知らない', '87d0b7164be317d0')).



 pattern(rule_3, [Pattern, Template, Status, Act1, Act2, Act3, Act4, Act5, Act6])

  :- (operation_log(datetime(Act1), ibss_log( Qnode1, Activity1, Type1, Concept1, _, _)), Type1=='prepared_question', Activity1\=='add'),

     operation_log(datetime(Act2_1), ibss_log( Anode1, Activity2, 'answer', _, _, Qnode1)),

     (operation_log(datetime(Act3_1), ibss_log( Anode1, 'edit', 'answer', _, _, Qnode1)), newestDate_at_time(Act3_1, Anode1, Act2_1)),

     (operation_log(datetime(Act4_1), ibss_log( Qnode2, Activity4, Type4, Concept4, _, _)), Concept1 \== Concept4, class_in(Concept1, Concept4), Type4=='prepared_question', Activity4\=='add'),

     (operation_log(datetime(Act5_1), ibss_log( Anode2, Activity5, 'answer', _, _, Qnode2)), Activity5\=='add', Activity5\=='delete', time_compare(Act3_1,Act5_1,Act3_1), newestDate_at_time(Act3_1, Anode2, Act5_1)),

     ((operation_log(datetime(Act6_1), ibss_log( Anode2, 'edit', 'answer', _, _, _)),

      newestDate_at_time(Act6_1, Qnode1, Act1), newestDate_at_time(Act6_1, Anode1, Act3_1), newestDate_at_time(Act6_1, Qnode2, Act4_1), newestDate_at_time(Act6_1, Anode2, Act5_1))

          ->(Status='full', Pattern='pattern_3',
                ((Activity2='add')->(Template='template_2_2', Act2=Act3_1, Act3=Act4_1, Act4=Act5_1, Act5=Act6_1, Act6='null')
                                    ;(Template='template_2_1', Act2=Act2_1, Act3=Act3_1, Act4=Act4_1, Act5=Act5_1, Act6=Act6_1)))

            ;(Status='fail', Pattern='pattern_4',
                  ((Activity2='add')->(Template='template_4_2', Act2=Act3_1, Act3=Act4_1, Act4=Act5_1, Act5=Act5_1, Act6='null')
                                              ;(Template='template_4_1', Act2=Act2_1, Act3=Act3_1, Act4=Act4_1, Act5=Act5_1, Act6=Act6_1)))).




         pattern(rule_4, [Pattern, Template, Status, Act1, Act2, Act3, Act4, Act5, Act6])

          :- (operation_log(datetime(Act1), ibss_log( Qnode1, Activity1, Type1, Concept1, _, _)), Type1=='prepared_question', Activity1\=='add'),

             operation_log(datetime(Act2_1), ibss_log( Anode1, Activity2, 'answer', _, _, Qnode1)),

             (operation_log(datetime(Act3_1), ibss_log( Anode1, 'edit', 'answer', _, _, Qnode1)), newestDate_at_time(Act3_1, Anode1, Act2_1)),

             (operation_log(datetime(Act4_1), ibss_log( Qnode2, Activity4, Type4, Concept4, _, _)), Concept1 \== Concept4, class_out(Concept1, Concept4), Type4=='prepared_question', Activity4\=='add'),

             (operation_log(datetime(Act5_1), ibss_log( Anode2, Activity5, 'answer', _, _, Qnode2)), Activity5\=='add', Activity5\=='delete', time_compare(Act3_1,Act5_1,Act3_1), newestDate_at_time(Act3_1, Anode2, Act5_1)),

             ((operation_log(datetime(Act6_1), ibss_log( Anode2, 'edit', 'answer', _, _, _)),

              newestDate_at_time(Act6_1, Qnode1, Act1), newestDate_at_time(Act6_1, Anode1, Act3_1), newestDate_at_time(Act6_1, Qnode2, Act4_1), newestDate_at_time(Act6_1, Anode2, Act5_1))

                  ->(Status='full', Pattern='pattern_5',
                        ((Activity2='add')->(Template='template_3_2', Act2=Act3_1, Act3=Act4_1, Act4=Act5_1, Act5=Act6_1, Act6='null')
                                            ;(Template='template_3_1', Act2=Act2_1, Act3=Act3_1, Act4=Act4_1, Act5=Act5_1, Act6=Act6_1)))

                    ;(Status='fail', Pattern='pattern_6',
                          ((Activity2='add')->(Template='template_5_2', Act2=Act3_1, Act3=Act4_1, Act4=Act5_1, Act5=Act5_1, Act6='null')
                                              ;(Template='template_5_1', Act2=Act2_1, Act3=Act3_1, Act4=Act4_1, Act5=Act5_1, Act6=Act6_1)))).


        pattern(rule_5, [Pattern, Template, Status, Act1, Act2, Act3, Act4, Act5, Act6])

         :- (operation_log(datetime(Act1), ibss_log( Qnode1, Activity1, Type1, Concept1, _, _)), Type1=='prepared_question', Activity1\=='add'),

            operation_log(datetime(Act2_1), ibss_log( Anode1, Activity2, 'answer', _, _, Qnode1)),

            (operation_log(datetime(Act3_1), ibss_log( Anode1, 'edit', 'answer', _, _, Qnode1)), newestDate_at_time(Act3_1, Anode1, Act2_1)),

            (operation_log(datetime(Act4_1), ibss_log( Qnode2, Activity4, Type4, Concept4, _, _)), Concept1 \== Concept4, class_activity(Concept1, Concept4), Type4=='prepared_question', Activity4\=='add'),

            (operation_log(datetime(Act5_1), ibss_log( Anode2, Activity5, 'answer', _, _, Qnode2)), Activity5\=='add', Activity5\=='delete', time_compare(Act3_1,Act5_1,Act3_1), newestDate_at_time(Act3_1, Anode2, Act5_1)),

            ((operation_log(datetime(Act6_1), ibss_log( Anode2, 'edit', 'answer', _, _, _)),

             newestDate_at_time(Act6_1, Qnode1, Act1), newestDate_at_time(Act6_1, Anode1, Act3_1), newestDate_at_time(Act6_1, Qnode2, Act4_1), newestDate_at_time(Act6_1, Anode2, Act5_1))

                 ->(Status='full', Pattern='pattern_7',
                       ((Activity2='add')->(Template='template_1_2', Act2=Act3_1, Act3=Act4_1, Act4=Act5_1, Act5=Act6_1, Act6='null')
                                           ;(Template='template_1_1', Act2=Act2_1, Act3=Act3_1, Act4=Act4_1, Act5=Act5_1, Act6=Act6_1)))

                   ;(Status='fail', Pattern='pattern_8',
                         ((Activity2='add')->(Template='template_6_2', Act2=Act3_1, Act3=Act4_1, Act4=Act5_1, Act5=Act6_1, Act6='null')
                                             ;(Template='template_6_1', Act2=Act2_1, Act3=Act3_1, Act4=Act4_1, Act5=Act5_1, Act6=Act6_1)))).






%６. (real pattern_9) ある答えノードを編集した後，そのサブ活動の答えノードを編集すること

        pattern(rule_6, [Pattern, Template, Status, Act1, Act2, Act3, Act4, Act5, Act6])

         :- (operation_log(datetime(Act1), ibss_log( Qnode1, Activity1, Type1, Concept1, _, _)), Type1=='prepared_question', Activity1\=='add'),

            operation_log(datetime(Act2_1), ibss_log( Anode1, Activity2, 'answer', _, _, Qnode1)),

            (operation_log(datetime(Act3_1), ibss_log( Anode1, 'edit', 'answer', _, _, Qnode1)), newestDate_at_time(Act3_1, Anode1, Act2_1)),

            (operation_log(datetime(Act4_1), ibss_log( Qnode2, Activity4, Type4, Concept4, _, _)), Concept1 \== Concept4, class_activity(CONCEPT_master, Concept1), class_activity(CONCEPT_master, Concept4), Type4=='prepared_question', Activity4\=='add'),

            (operation_log(datetime(Act5_1), ibss_log( Anode2, Activity5, 'answer', _, _, Qnode2)), Activity5\=='add', Activity5\=='delete', time_compare(Act3_1,Act5_1,Act3_1), newestDate_at_time(Act3_1, Anode2, Act5_1)),

            ((operation_log(datetime(Act6_1), ibss_log( Anode2, 'edit', 'answer', _, _, _)),

             newestDate_at_time(Act6_1, Qnode1, Act1), newestDate_at_time(Act6_1, Anode1, Act3_1), newestDate_at_time(Act6_1, Qnode2, Act4_1), newestDate_at_time(Act6_1, Anode2, Act5_1))

                 ->(Status='full', Pattern='pattern_9',
                       ((Activity2='add')->(Template='template_1_2', Act2=Act3_1, Act3=Act4_1, Act4=Act5_1, Act5=Act6_1, Act6='null')
                                           ;(Template='template_1_1', Act2=Act2_1, Act3=Act3_1, Act4=Act4_1, Act5=Act5_1, Act6=Act6_1)))

                   ;(Status='fail', Pattern='pattern_10',
                         ((Activity2='add')->(Template='template_6_2', Act2=Act3_1, Act3=Act4_1, Act4=Act5_1, Act5=Act5_1, Act6='null')
                                             ;(Template='template_6_1', Act2=Act2_1, Act3=Act3_1, Act4=Act4_1, Act5=Act5_1, Act6=Act6_1)))).




%７. (real pattern_11) ある答えノードを編集した後，その合理性の答えノードを編集すること
pattern(rule_7, [Pattern, Template, Status, Act1, Act2, Act3, Act4, Act5, Act6])

 :- (operation_log(datetime(Act1), ibss_log( Qnode1, Activity1, Type1, Concept1, _, _)), Type1=='prepared_question', Activity1\=='add'),

    operation_log(datetime(Act2_1), ibss_log( Anode1, Activity2, 'answer', _, _, Qnode1)),

    (operation_log(datetime(Act3_1), ibss_log( Anode1, 'edit', 'answer', _, _, Qnode1)), newestDate_at_time(Act3_1, Anode1, Act2_1)),

    (operation_log(datetime(Act4_1), ibss_log( Qnode2, Activity4, Type4, Concept4, _, _)), Concept1 \== Concept4, (rationality(Concept1, Concept4);rationality(Concept4, Concept1)), Type4=='prepared_question', Activity4\=='add'),

    (operation_log(datetime(Act5_1), ibss_log( Anode2, Activity5, 'answer', _, _, Qnode2)), Activity5\=='add', Activity5\=='delete', time_compare(Act3_1,Act5_1,Act3_1), newestDate_at_time(Act3_1, Anode2, Act5_1)),

    ((operation_log(datetime(Act6_1), ibss_log( Anode2, 'edit', 'answer', _, _, _)),

     newestDate_at_time(Act6_1, Qnode1, Act1), newestDate_at_time(Act6_1, Anode1, Act3_1), newestDate_at_time(Act6_1, Qnode2, Act4_1), newestDate_at_time(Act6_1, Anode2, Act5_1))

         ->(Status='full', Pattern='pattern_11',
               ((Activity2='add')->(Template='template_7_2', Act2=Act3_1, Act3=Act4_1, Act4=Act5_1, Act5=Act6_1, Act6='null')
                                   ;(Template='template_7_1', Act2=Act2_1, Act3=Act3_1, Act4=Act4_1, Act5=Act5_1, Act6=Act6_1)))

           ;(Status='fail', Pattern='pattern_12',
                 ((Activity2='add')->(Template='template_8_2', Act2=Act3_1, Act3=Act4_1, Act4=Act5_1, Act5=Act5_1, Act6='null')
                                     ;(Template='template_8_1', Act2=Act2_1, Act3=Act3_1, Act4=Act4_1, Act5=Act5_1, Act6=Act6_1)))).




%８. (real pattern_13) 考えないことを考えた(合理性以外)
pattern(rule_8, [Pattern, Template, Status, T1date, Act1])

:- (operation_log(datetime(R1), reflection_log( TemplateR1, 'not_think', '0', T1date, Tid, _, _, '',targets(_))),TemplateR1\=='template_8_1', TemplateR1\=='template_8_2'),

   (operation_log(datetime(Act1), ibss_log( Tid, 'edit', _, _, _, _)), time_compare(Act1, R1, Act1)), Status='reason', Template='template_9', Pattern='pattern_13'.
% 考えないと意思決定していた『%S』について，今回意思決定を変更し『%S』と再考しました．なぜ今回意思決定を変更しましたか？

% operation_log(datetime('2019-01-25 08:17:51.497'), reflection_log( 'template_6_1', 'not_think', '0', '2019-01-25 08:12:13.145', '88222386024feff5', '', '『実践の目的は何ですか？』について，『システムの効果の確認』を再考し『フィードバックの効果の確認』と変更したことに伴い，『実践の手順はどのようなものですか？』の『1習慣のテスト利用』についても再考しましたか？', '',targets(['2019-01-25 08:10:07.308', '2019-01-25 08:10:39.191', '2019-01-25 08:13:07.191', '2019-01-25 08:11:45.172', '2019-01-25 08:12:13.145']))).
% operation_log(datetime('2019-01-25 08:18:52.556'), ibss_log( '88222386024feff5', 'edit', 'answer', '1509010690552_n141', '10日間の運営後，事前評価を行う', '88222300b1045101')).


% operation_log(datetime(_), reflection_log( Reflection_Tamplated, 'not_think', '0', '2019-01-24 08:29:00.961', '87d0b79a4627fa1b', '2019-01-24 08:28:48.499', '『実践仮説は何ですか？』について，『実践仮説なんて知らない』と追加したことに伴い，『実践の目的は何ですか？』の『実践目的なんて知らない』との合理性を考えましたか？', '',targets(['2019-01-24 08:29:03.560', '2019-01-24 08:29:14.035', '2019-01-24 08:28:48.499', '2019-01-24 08:29:00.961', '2019-01-24 08:29:00.961', 'null']))).


 %９. (real pattern_14) 考えないことを考えた(合理性)
 pattern(rule_9, [Pattern, Template, Status, Rdate, T1date, Act1])

 :- (operation_log(datetime(R1), reflection_log( TemplateR1, 'not_think', '0', T1date, T1id, Rdate, _, _,targets(_))),TemplateR1=='template_8_1';TemplateR1=='template_8_2'),

    operation_log(datetime(Act1), ibss_log( T1id, _, _, _, _, _)), time_compare(Act1, R1, Act1),

    Status='reason', Template='template_10', Pattern='pattern_14'.


% 考えないと意思決定していた『%S』と『%S』の合理性について，今回意思決定を変更し考えました．なぜ今回意思決定を変更しましたか？

:- pattern(rule_1,X),writef('%t\n',[X]),fail;true.
:- pattern(rule_2,X),writef('%t\n',[X]),fail;true.
:- pattern(rule_3,X),writef('%t\n',[X]),fail;true.
:- pattern(rule_4,X),writef('%t\n',[X]),fail;true.
:- pattern(rule_5,X),writef('%t\n',[X]),fail;true.
:- pattern(rule_6,X),writef('%t\n',[X]),fail;true.
:- pattern(rule_7,X),writef('%t\n',[X]),fail;true.
:- pattern(rule_8,X),writef('%t\n',[X]),fail;true.
:- pattern(rule_9,X),writef('%t\n',[X]),fail;true.







:- halt.
